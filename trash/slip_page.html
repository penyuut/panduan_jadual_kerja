<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slip Page</title>
    <style>
        /* Add your styles here */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #1E3A8A;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        table th {
            background-color: #3B82F6;
            color: white;
        }
        table td {
            background-color: #f9fafb;
        }

	.form-section, .mini-form {
            border: 1px solid #ddd;
            padding: 20px;
            margin-top: 20px;
            background-color: #fff;
            border-radius: 8px;
        }
        .form-section h3, .mini-form h3 {
            color: #0066cc;
    </style>
</head>
<body>

    <div class="form-sectioN"> 
    <h1>Selected Items</h1>
    <table id="cartTable">
        <tr>
            <th>No</th>
            <th>Keterangan</th>
            <th>BHG</th>
            <th>Bil</th>
            <th>RM</th>
            <th>Kuantiti</th>
            <th>Harga</th>
        </tr>
    </table>
    <p><strong>Jumlah Keseluruhan: </strong> RM <span id="totalAmount">0.00</span></p>

<h3>Tambah Item</h3>
        <li><a href="Bahagian I_User.php">BAHAGIAN I</a></li>
        <li><a href="Bahagian II_User.php">BAHAGIAN II</a></li>
        <li><a href="Bahagian III_User.php">BAHAGIAN III</a></li>
        <li><a href="Bahagian IV_User.php">BAHAGIAN IV</a></li>
        <li><a href="Bahagian V_User.php">BAHAGIAN V</a></li>
        <li><a href="Bahagian VI_User.php">BAHAGIAN VI</a></li>
        <li><a href="Bahagian VII_User.php">BAHAGIAN VII</a></li>
    </div>

<!-- ITEM HARGA PERSETUJUAN Section -->
    <div class="form-section">
        <h2>ITEM HARGA PERSETUJUAN</h2>
        <form method="post">
            <p><b>Ada Item Persetujuan?</b></p>
            <input type="radio" id="ada" name="item_approval" value="ada" onclick="toggleApprovalForm(true)">
            <label for="ada">Ada</label>
            <input type="radio" id="tiada" name="item_approval" value="tiada" onclick="toggleApprovalForm(false)">
            <label for="tiada">Tiada</label>

            <!-- Form for adding approved items (hidden by default) -->
            <div id="approvalForm" style="display: none;">
                <h3>Add Approved Item</h3>
                <label for="item_name">Item:</label>
                <input type="text" id="item_name" name="item_name" required>
                <br>
                <label for="price">Harga:</label>
                <input type="number" id="price" name="price" required step="0.01">
                <br>
                <label for="quantity">Kuantiti:</label>
                <input type="number" id="quantity" name="quantity" required>
                <br><br>
                <button type="submit" name="add_approved_item">Add New Item</button>
            </div>
        </form>
    </div>

    <!-- Displaying approved items in a separate box container -->
    <div class="form-section">
        <h2>LIST ITEM HARGA PERSETUJUAN</h2>
        <table>
            <tr>
                <th>No</th>
                <th>Item</th>
                <th>Harga (RM)</th>
                <th>Kuantiti</th>
                <th>Total Harga (RM)</th>
                <th>Action</th>
            </tr>
            <?php
            if ($approved_items_result->num_rows > 0) {
                $no = 1; // Counter for the "No" column
                while ($row = $approved_items_result->fetch_assoc()) {
                    $total_harga_approved = $row['quantity'] * $row['price']; // Calculate total price for approved items
                    echo "<tr>";
                    echo "<td>" . $no++ . "</td>";
                    echo "<td>" . $row['item_name'] . "</td>";
                    echo "<td>" . number_format($row['price'], 2) . "</td>";
                    echo "<td>" . $row['quantity'] . "</td>";
                    echo "<td>" . number_format($total_harga_approved, 2) . "</td>";
                    echo "<td>
                            <form method='post'>
                                <input type='hidden' name='item_id' value='" . $row['id'] . "'>
                                <button type='submit' name='remove_approved_item'>Remove</button>
                            </form>
                          </td>";
                    echo "</tr>";
                }
            } else {
                echo "<tr><td colspan='6'>Tiada item yang disetujui</td></tr>";
            }
            ?>
        </table>
    </div>

	<!-- Lokasi Form -->
<div class="form-section">
    <h2>Lokasi</h2>
    <form method="post">
        <label for="projek">Projek:</label>
        <input type="text" id="projek" name="projek" style="width: 80%; padding: 10px;" required>

        <br>

        <label for="jarak">Jarak (km):</label>
        <input type="number" id="jarak" name="jarak" required>

        <br>

        <label for="negeri">Negeri:</label>
        <select id="negeri" name="negeri" onchange="updateDaerah()" required>
            <option value="pahang">JKR Elektrik Pahang</option>
            <option value="johor">JKR Elektrik Johor</option>
            <option value="selangor">JKR Elektrik Selangor</option>
            <option value="negeri_sembilan">JKR Elektrik Negeri Sembilan</option>
            <option value="melaka">JKR Elektrik Melaka</option>
            <option value="kelantan">JKR Elektrik Kelantan</option>
            <option value="kedah">JKR Elektrik Kedah</option>
            <option value="pulau_pinang">JKR Elektrik Pulau Pinang</option>
            <option value="perak">JKR Elektrik Perak</option>
            <option value="terengganu">JKR Elektrik Terengganu</option>
            <option value="putrajaya">JKR Elektrik Putrajaya</option>
            <option value="kuala_lumpur">JKR Elektrik Kuala Lumpur</option>
            <option value="labuan">JKR Elektrik Labuan</option>
            <option value="perlis">JKR Elektrik Perlis</option>
            <option value="kesedar">JKR Elektrik KESEDAR</option>
            <option value="ketengah">JKR Elektrik KETENGAH</option>
        </select>

        <br>

        <label for="daerah">Daerah:</label>
        <select id="daerah" name="daerah" required>
            <!-- Daerah options will be updated dynamically -->
        </select>

        <br>

        <button type="submit" name="submit_lokasi">Hantar Lokasi</button>
    </form>
</div>

<!-- Tambahan Peratusan Form -->
<div class="form-section">
    <form method="post">
<h3>TAMBAHAN PERATUSAN</h3>
        
        <!-- Radio buttons for Kenderaan type -->
        <label>
            <input type="radio" name="kenderaan" value="darat" onclick="updateTaxPercentage('air')" required> Tambahan peratusan sebanyak 2% lagi dari JKKE hendaklah dibuat sekiranya jalan ke sesuatu tempat kerja hanya boleh dilalui oleh kenderaan darat berjentera beroda dua (two-wheel vehicle) atau kenderaan berjentera yang mempunyai pacuan empat roda (four-wheel drive vehicle).
        </label>
        <label>
            <input type="radio" name="kenderaan" value="air" onclick="updateTaxPercentage('darat')" required> Tambahan peratusan sebanyak 5% lagi dari JKKE hendaklah dibuat sekiranya jalan ke sesuatu tempat kerja hanya boleh dilalui menggunakan kenderaan air dengan mengharungi sungai, tasik atau laut, tanpa jambatan.
        </label>
        
        <!-- Display tax percentage -->
        <div>
            <label for="tax_percentage">Tax Percentage:</label>
            <input type="text" id="tax_percentage" name="tax_percentage" readonly>
        </div>

        <!-- Submit Button -->
        <button type="submit" name="submit_tambahan_peratusan">TAMBAHAN PERATUSAN</button>
  

    </form> 
</div>

<!-- Add this below the table displaying selected items -->
<a href="generate_slip.php" style="display:inline-block; padding: 10px 20px; background-color: #0066cc; color: white; text-decoration: none; border-radius: 5px;">Slip</a>



    <script>

const daerahOptions = {
        pahang: ['Bentong', 'Temerloh', 'Raub', 'Bera', 'Maran', 'Kuantan', 'Cameron Highlands', 'Kuala Lipis', 'Pekan', 'Jerantut', 'Rompin', 'Ulu Tembeling (Taman Negara)', 'Pulau Tioman'],
        johor: ['Johor Bahru', 'Pontian', 'Segamat', 'Kluang', 'Batu Pahat', 'Muar', 'Kota Tinggi', 'Mersing', 'Tangkak', 'Kulaijaya', 'Pulau Sibu dan Pulau Tinggi', 'Pulau Aur dan Pulau Pemanggil'],
        selangor: ['Semua daerah kecuali Sabak Bernam dan Kuala Selangor', 'Sabak Bernam dan Kuala Selangor', 'Pulau Ketam'],
        negeri_sembilan: ['Seremban', 'Kuala Pilah', 'Port Dickson', 'Tampin', 'Rembau', 'Kuala Klawang', 'Bandar Baru Serting'],
        melaka: ['Bandar Melaka'],
        kelantan: ['Kota Bahru', 'Bachok', 'Pasir Puteh', 'Pasir Mas', 'Tumpat', 'Tanah Merah', 'Machang', 'Jeli', 'Kuala Krai', 'Gua Musang'],
        kedah: ['Kota Setar', 'Sungai Petani', 'Kulim', 'Baling', 'Padang Terap', 'Yan', 'Sik', 'Bandar Baharu', 'Pendang', 'Langkawi'],
        pulau_pinang: ['Pulau Pinang', 'Butterworth', 'Bukit Bendera', 'Pulau-pulau'],
        perak: ['Kinta', 'Kuala Kangsar', 'Larut & Matang', 'Kerian', 'Batang Padang', 'Hilir Perak', 'Manjung', 'Perak Tengah', 'Hulu Perak', 'Pos Orang Asli', 'Pulau-pulau (Pulau Pangkor)'],
        terengganu: ['Kuala Terengganu', 'Dungun', 'Kemaman', 'Besut', 'Hulu Terengganu', 'Setiu', 'Marang', 'Pulau-Pulau'],
        labuan: ['Labuan', 'Pulau-pulau'],
        putrajaya: ['Putrajaya'],
        kuala_lumpur: ['Kuala Lumpur'],
        perlis: ['Kangar'],
        kesedar: ['Kesedar'],
        ketengah: ['Ketengah']
    };

// Update Daerah options based on selected Negeri
    function updateDaerah() {
        const negeri = document.getElementById('negeri').value;
        const daerahSelect = document.getElementById('daerah');
        daerahSelect.innerHTML = ''; // Clear existing options

        // Add new options based on the selected Negeri
        if (daerahOptions[negeri]) {
            daerahOptions[negeri].forEach(function(daerah) {
                const option = document.createElement('option');
                option.value = daerah.toLowerCase().replace(/ /g, '_'); // Convert space to underscore
                option.textContent = daerah;
                daerahSelect.appendChild(option);
            });
        }
    }
 // Initialize Daerah options on page load
    window.onload = function() {
        updateDaerah(); // Populate Daerah dropdown based on default Negeri (if needed)
    };

        // Function to toggle the display of the approval form
        function toggleApprovalForm(show) {
            const approvalForm = document.getElementById('approvalForm');
            if (show) {
                approvalForm.style.display = 'block';
            } else {
                approvalForm.style.display = 'none';
            }
        }

function updateTaxPercentage(kenderaan) {
    var taxPercentage = 0;
    
    if (kenderaan === 'air') {
        taxPercentage = '2%';
    } else if (kenderaan === 'darat') {
        taxPercentage = '5%';
    }
    
    // Set the value in the tax percentage input field
    document.getElementById('tax_percentage').value = taxPercentage;
}
        // Load cart data from local storage
        function loadCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartTable = document.getElementById('cartTable');
            const totalSpan = document.getElementById('totalAmount');
            let cartHtml = '';

            let totalAmount = 0;

            cart.forEach((item, index) => {
                cartHtml += <tr>
                                <td>${index + 1}</td>
                                <td>${item.keterangan}</td>
                                <td>${item.bhg}</td>
                                <td>${item .bil}</td>
                                <td>${item.harga}</td>
                                <td>${item.kuantiti}</td>
                                <td>${item.hargaTotal}</td>
                            </tr>;
                totalAmount += item.hargaTotal;
            });

            cartTable.innerHTML += cartHtml;
            totalSpan.innerText = totalAmount.toFixed(2);
        }

        // Load cart data when the page loads
        window.onload = loadCart;
    </script>
</body>
</html>